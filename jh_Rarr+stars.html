<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Johannes Heisig">
<meta name="dcterms.date" content="2025-10-06">

<title>Accessing Zarr data from STAC (?) using Rarr (??)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="jh_Rarr+stars_files/libs/clipboard/clipboard.min.js"></script>
<script src="jh_Rarr+stars_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="jh_Rarr+stars_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="jh_Rarr+stars_files/libs/quarto-html/popper.min.js"></script>
<script src="jh_Rarr+stars_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="jh_Rarr+stars_files/libs/quarto-html/anchor.min.js"></script>
<link href="jh_Rarr+stars_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="jh_Rarr+stars_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="jh_Rarr+stars_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="jh_Rarr+stars_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="jh_Rarr+stars_files/libs/bootstrap/bootstrap-7cb767a14c60d3560c64fbd99ff0b7ca.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Accessing Zarr data from STAC (?) using Rarr (??)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Johannes Heisig </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 6, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="local-zarr-with-rarr" class="level2">
<h2 class="anchored" data-anchor-id="local-zarr-with-rarr">Local Zarr with Rarr</h2>
<p>Read the sample Zarr array provided with the Rarr package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remotes::install_github("sharlagelfand/Rarr")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rarr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Using a local file provided with the package</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## This array has 3 dimensions</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>z1 <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"zarr_examples"</span>, <span class="st">"row-first"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"int32.zarr"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">package =</span> <span class="st">"Rarr"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">zarr_overview</span>(z1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Type: Array
Path: /home/jheisig/R/x86_64-pc-linux-gnu-library/4.3/Rarr/extdata/zarr_examples/row-first/int32.zarr
Shape: 30 x 20 x 10
Chunk Shape: 10 x 10 x 5
No. of Chunks: 12 (3 x 2 x 2)
Data Type: int32
Endianness: little
Compressor: blosc</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## read the entire array</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>z1_full <span class="ot">=</span> <span class="fu">read_zarr_array</span>(<span class="at">zarr_array_path =</span> z1)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(z1_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30 20 10</code></pre>
</div>
</div>
<p>Check the metadata of the Zarr array</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>array_meta <span class="ot">=</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="fu">file.path</span>(z1, <span class="st">".zarray"</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>array_meta<span class="sc">$</span>shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 30

[[2]]
[1] 20

[[3]]
[1] 10</code></pre>
</div>
</div>
<p>Convert to a stars object</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.12.2, GDAL 3.9.3, PROJ 9.4.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">st_z1 =</span> <span class="fu">st_as_stars</span>(z1_full))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 3 dimensions and 1 attribute
attribute(s):
    Min. 1st Qu. Median       Mean 3rd Qu. Max.
A1     0       0      0 0.03983333       0   20
dimension(s):
   from to offset delta point x/y
X1    1 30      0     1 FALSE [x]
X2    1 20      0     1 FALSE [y]
X3    1 10      0     1 FALSE    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(st_z1, <span class="at">breaks =</span> <span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="jh_Rarr+stars_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next: Recognise the dimensions as stars coordinates…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#(st_z1 = st_as_stars(z1_full))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="remote-zarr-with-stars-directly" class="level2">
<h2 class="anchored" data-anchor-id="remote-zarr-with-stars-directly">Remote Zarr with stars (directly)</h2>
<blockquote class="blockquote">
<p>not successful yet.</p>
</blockquote>
<p>..using a Zarr archive stored on S3, registered in a STAC catalog and hosted by EODC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>zarr_s3 <span class="ot">=</span> <span class="st">"https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:sample-data/tutorial_data/cpm_v253/S2B_MSIL1C_20250113T103309_N0511_R108_T32TLQ_20250113T122458.zarr"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>vsi_url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"/vsicurl/"</span>, zarr_s3)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">gdal_utils</span>(<span class="at">source =</span> vsi_url)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">read_stars</span>(vsi_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>trying to read file: /vsicurl/https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:sample-data/tutorial_data/cpm_v253/S2B_MSIL1C_20250113T103309_N0511_R108_T32TLQ_20250113T122458.zarr</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): file not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_mdim</span>(vsi_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in CPL_read_mdim(file, array_name, options, offset, count, step, : GDAL
Error 11: HTTP response code: 404</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): file not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">rast</span>(vsi_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: HTTP response code: 404 (GDAL error 11)</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: /vsicurl/https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:sample-data/tutorial_data/cpm_v253/S2B_MSIL1C_20250113T103309_N0511_R108_T32TLQ_20250113T122458.zarr</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>vsi_url <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"ZARR:/vsicurl/"</span>, <span class="st">"https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:sample-data/tutorial_data/cpm_v253/S2B_MSIL1C_20250113T103309_N0511_R108_T32TLQ_20250113T122458.zarr"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">gdal_utils</span>(<span class="at">source =</span> vsi_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There is likely a quoting error of the whole connection string. (GDAL
error 1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_stars</span>(vsi_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There is likely a quoting error of the whole connection string. (GDAL
error 1)

Warning: There is likely a quoting error of the whole connection string. (GDAL
error 1)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>trying to read file: ZARR:/vsicurl/https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:sample-data/tutorial_data/cpm_v253/S2B_MSIL1C_20250113T103309_N0511_R108_T32TLQ_20250113T122458.zarr</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): file not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_mdim</span>(vsi_url, <span class="at">variable =</span> <span class="st">"/quality/mask/r60m/b09"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There is likely a quoting error of the whole connection string. (GDAL
error 1)</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): file not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">rast</span>(vsi_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There is likely a quoting error of the whole connection string. (GDAL
error 1)</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: [rast] file does not exist: ZARR:/vsicurl/https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:sample-data/tutorial_data/cpm_v253/S2B_MSIL1C_20250113T103309_N0511_R108_T32TLQ_20250113T122458.zarr</code></pre>
</div>
</div>
</section>
<section id="remote-zarr-with-rarr" class="level2">
<h2 class="anchored" data-anchor-id="remote-zarr-with-rarr">Remote Zarr with Rarr</h2>
<blockquote class="blockquote">
<p>construct a stars object from meta data</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get meta data for all assets in the zarr archive!</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">zarr_overview</span>(zarr_s3, <span class="at">as_data_frame =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">var =</span> <span class="fu">sub</span>(zarr_s3, <span class="st">""</span>, path)) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(var, <span class="fu">everything</span>(), <span class="sc">-</span>path) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                   var nchunks  data_type
1                           /conditions/geometry/angle       1 unicode224
2                            /conditions/geometry/band       1  unicode96
3                        /conditions/geometry/detector       1      int64
4                 /conditions/geometry/mean_sun_angles       1    float64
5   /conditions/geometry/mean_viewing_incidence_angles       1    float64
6                      /conditions/geometry/sun_angles       1    float64
7        /conditions/geometry/viewing_incidence_angles       4    float64
8                               /conditions/geometry/x       1      int64
9                               /conditions/geometry/y       1      int64
10        /conditions/mask/detector_footprint/r10m/b02      36      uint8
11        /conditions/mask/detector_footprint/r10m/b03      36      uint8
12        /conditions/mask/detector_footprint/r10m/b04      36      uint8
13        /conditions/mask/detector_footprint/r10m/b08      36      uint8
14          /conditions/mask/detector_footprint/r10m/x       1      int64
15          /conditions/mask/detector_footprint/r10m/y       1      int64
16        /conditions/mask/detector_footprint/r20m/b05      36      uint8
17        /conditions/mask/detector_footprint/r20m/b06      36      uint8
18        /conditions/mask/detector_footprint/r20m/b07      36      uint8
19        /conditions/mask/detector_footprint/r20m/b11      36      uint8
20        /conditions/mask/detector_footprint/r20m/b12      36      uint8
21        /conditions/mask/detector_footprint/r20m/b8a      36      uint8
22          /conditions/mask/detector_footprint/r20m/x       1      int64
23          /conditions/mask/detector_footprint/r20m/y       1      int64
24        /conditions/mask/detector_footprint/r60m/b01      36      uint8
25        /conditions/mask/detector_footprint/r60m/b09      36      uint8
26        /conditions/mask/detector_footprint/r60m/b10      36      uint8
27          /conditions/mask/detector_footprint/r60m/x       1      int64
28          /conditions/mask/detector_footprint/r60m/y       1      int64
29        /conditions/mask/l1c_classification/r60m/b00      36      uint8
30          /conditions/mask/l1c_classification/r60m/x       1      int64
31          /conditions/mask/l1c_classification/r60m/y       1      int64
32                /conditions/meteorology/cams/aod1240       1    float32
33                 /conditions/meteorology/cams/aod469       1    float32
34                 /conditions/meteorology/cams/aod550       1    float32
35                 /conditions/meteorology/cams/aod670       1    float32
36                 /conditions/meteorology/cams/aod865       1    float32
37               /conditions/meteorology/cams/bcaod550       1    float32
38               /conditions/meteorology/cams/duaod550       1    float32
39          /conditions/meteorology/cams/isobaricInhPa       1    float64
40               /conditions/meteorology/cams/latitude       1    float64
41              /conditions/meteorology/cams/longitude       1    float64
42                 /conditions/meteorology/cams/number       1      int64
43               /conditions/meteorology/cams/omaod550       1    float32
44               /conditions/meteorology/cams/ssaod550       1    float32
45                   /conditions/meteorology/cams/step       1      int64
46               /conditions/meteorology/cams/suaod550       1    float32
47                /conditions/meteorology/cams/surface       1    float64
48                   /conditions/meteorology/cams/time       1      int64
49             /conditions/meteorology/cams/valid_time       1      int64
50                      /conditions/meteorology/cams/z       1    float32
51         /conditions/meteorology/ecmwf/isobaricInhPa       1    float64
52              /conditions/meteorology/ecmwf/latitude       1    float64
53             /conditions/meteorology/ecmwf/longitude       1    float64
54                   /conditions/meteorology/ecmwf/msl       1    float32
55                /conditions/meteorology/ecmwf/number       1      int64
56                     /conditions/meteorology/ecmwf/r       1    float32
57                  /conditions/meteorology/ecmwf/step       1      int64
58               /conditions/meteorology/ecmwf/surface       1    float64
59                  /conditions/meteorology/ecmwf/tco3       1    float32
60                  /conditions/meteorology/ecmwf/tcwv       1    float32
61                  /conditions/meteorology/ecmwf/time       1      int64
62                   /conditions/meteorology/ecmwf/u10       1    float32
63                   /conditions/meteorology/ecmwf/v10       1    float32
64            /conditions/meteorology/ecmwf/valid_time       1      int64
65                  /measurements/reflectance/r10m/b02      36     uint16
66                  /measurements/reflectance/r10m/b03      36     uint16
67                  /measurements/reflectance/r10m/b04      36     uint16
68                  /measurements/reflectance/r10m/b08      36     uint16
69                    /measurements/reflectance/r10m/x       1      int64
70                    /measurements/reflectance/r10m/y       1      int64
71                  /measurements/reflectance/r20m/b05      36     uint16
72                  /measurements/reflectance/r20m/b06      36     uint16
73                  /measurements/reflectance/r20m/b07      36     uint16
74                  /measurements/reflectance/r20m/b11      36     uint16
75                  /measurements/reflectance/r20m/b12      36     uint16
76                  /measurements/reflectance/r20m/b8a      36     uint16
77                    /measurements/reflectance/r20m/x       1      int64
78                    /measurements/reflectance/r20m/y       1      int64
79                  /measurements/reflectance/r60m/b01      36     uint16
80                  /measurements/reflectance/r60m/b09      36     uint16
81                  /measurements/reflectance/r60m/b10      36     uint16
82                    /measurements/reflectance/r60m/x       1      int64
83                    /measurements/reflectance/r60m/y       1      int64
84                    /quality/l1c_quicklook/r10m/band       1      int64
85                     /quality/l1c_quicklook/r10m/tci     108      uint8
86                       /quality/l1c_quicklook/r10m/x       1      int64
87                       /quality/l1c_quicklook/r10m/y       1      int64
88                              /quality/mask/r10m/b02      36      uint8
89                              /quality/mask/r10m/b03      36      uint8
90                              /quality/mask/r10m/b04      36      uint8
91                              /quality/mask/r10m/b08      36      uint8
92                                /quality/mask/r10m/x       1      int64
93                                /quality/mask/r10m/y       1      int64
94                              /quality/mask/r20m/b05      36      uint8
95                              /quality/mask/r20m/b06      36      uint8
96                              /quality/mask/r20m/b07      36      uint8
97                              /quality/mask/r20m/b11      36      uint8
98                              /quality/mask/r20m/b12      36      uint8
99                              /quality/mask/r20m/b8a      36      uint8
100                               /quality/mask/r20m/x       1      int64
101                               /quality/mask/r20m/y       1      int64
102                             /quality/mask/r60m/b01      36      uint8
103                             /quality/mask/r60m/b09      36      uint8
104                             /quality/mask/r60m/b10      36      uint8
105                               /quality/mask/r60m/x       1      int64
106                               /quality/mask/r60m/y       1      int64
    compressor          dim    chunk_dim
1        blosc            2            2
2        blosc           13           13
3        blosc            7            7
4        blosc            2            2
5        blosc        13, 2        13, 2
6        blosc    2, 23, 23    2, 23, 23
7        blosc 13, 7, 2.... 7, 4, 2,....
8        blosc           23           23
9        blosc           23           23
10       blosc 10980, 10980   1830, 1830
11       blosc 10980, 10980   1830, 1830
12       blosc 10980, 10980   1830, 1830
13       blosc 10980, 10980   1830, 1830
14       blosc        10980        10980
15       blosc        10980        10980
16       blosc   5490, 5490     915, 915
17       blosc   5490, 5490     915, 915
18       blosc   5490, 5490     915, 915
19       blosc   5490, 5490     915, 915
20       blosc   5490, 5490     915, 915
21       blosc   5490, 5490     915, 915
22       blosc         5490         5490
23       blosc         5490         5490
24       blosc   1830, 1830     305, 305
25       blosc   1830, 1830     305, 305
26       blosc   1830, 1830     305, 305
27       blosc         1830         1830
28       blosc         1830         1830
29       blosc   1830, 1830     305, 305
30       blosc         1830         1830
31       blosc         1830         1830
32       blosc         9, 9         9, 9
33       blosc         9, 9         9, 9
34       blosc         9, 9         9, 9
35       blosc         9, 9         9, 9
36       blosc         9, 9         9, 9
37       blosc         9, 9         9, 9
38       blosc         9, 9         9, 9
39        &lt;NA&gt;                          
40       blosc            9            9
41       blosc            9            9
42        &lt;NA&gt;                          
43       blosc         9, 9         9, 9
44       blosc         9, 9         9, 9
45        &lt;NA&gt;                          
46       blosc         9, 9         9, 9
47        &lt;NA&gt;                          
48        &lt;NA&gt;                          
49        &lt;NA&gt;                          
50       blosc         9, 9         9, 9
51        &lt;NA&gt;                          
52       blosc            9            9
53       blosc            9            9
54       blosc         9, 9         9, 9
55        &lt;NA&gt;                          
56       blosc         9, 9         9, 9
57        &lt;NA&gt;                          
58        &lt;NA&gt;                          
59       blosc         9, 9         9, 9
60       blosc         9, 9         9, 9
61        &lt;NA&gt;                          
62       blosc         9, 9         9, 9
63       blosc         9, 9         9, 9
64        &lt;NA&gt;                          
65       blosc 10980, 10980   1830, 1830
66       blosc 10980, 10980   1830, 1830
67       blosc 10980, 10980   1830, 1830
68       blosc 10980, 10980   1830, 1830
69       blosc        10980        10980
70       blosc        10980        10980
71       blosc   5490, 5490     915, 915
72       blosc   5490, 5490     915, 915
73       blosc   5490, 5490     915, 915
74       blosc   5490, 5490     915, 915
75       blosc   5490, 5490     915, 915
76       blosc   5490, 5490     915, 915
77       blosc         5490         5490
78       blosc         5490         5490
79       blosc   1830, 1830     305, 305
80       blosc   1830, 1830     305, 305
81       blosc   1830, 1830     305, 305
82       blosc         1830         1830
83       blosc         1830         1830
84       blosc            3            3
85       blosc 3, 10980.... 1, 1830,....
86       blosc        10980        10980
87       blosc        10980        10980
88       blosc 10980, 10980   1830, 1830
89       blosc 10980, 10980   1830, 1830
90       blosc 10980, 10980   1830, 1830
91       blosc 10980, 10980   1830, 1830
92       blosc        10980        10980
93       blosc        10980        10980
94       blosc   5490, 5490     915, 915
95       blosc   5490, 5490     915, 915
96       blosc   5490, 5490     915, 915
97       blosc   5490, 5490     915, 915
98       blosc   5490, 5490     915, 915
99       blosc   5490, 5490     915, 915
100      blosc         5490         5490
101      blosc         5490         5490
102      blosc   1830, 1830     305, 305
103      blosc   1830, 1830     305, 305
104      blosc   1830, 1830     305, 305
105      blosc         1830         1830
106      blosc         1830         1830</code></pre>
</div>
</div>
<p>Read the attributes of the Zarr archive</p>
<p>These both do not work…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Rarr<span class="sc">::</span><span class="fu">read_zattrs</span>(zarr_s3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in Rarr::read_zattrs(zarr_s3): The group or array does not contain attributes (.zattrs)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>Rarr<span class="sc">::</span><span class="fu">read_zattrs</span>(<span class="fu">file.path</span>(zarr_s3, <span class="st">".zattrs"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in Rarr::read_zattrs(file.path(zarr_s3, ".zattrs")): The group or array does not contain attributes (.zattrs)</code></pre>
</div>
</div>
<p>… so read json directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>attr_s3 <span class="ot">=</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="fu">file.path</span>(zarr_s3, <span class="st">".zattrs"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read data from a single band array and its coordinates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This time point to a single band asset directly!</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>zarr_s3_b01 <span class="ot">=</span> <span class="fu">paste0</span>(zarr_s3, <span class="st">"/measurements/reflectance/r60m/b01"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">zarr_overview</span>(zarr_s3_b01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Type: Array
Path: https://objects.eodc.eu/e05ab01a9d56408d82ac32d69a5aae2a:sample-data/tutorial_data/cpm_v253/S2B_MSIL1C_20250113T103309_N0511_R108_T32TLQ_20250113T122458.zarr/measurements/reflectance/r60m/b01/
Shape: 1830 x 1830
Chunk Shape: 305 x 305
No. of Chunks: 36 (6 x 6)
Data Type: uint16
Endianness: little
Compressor: blosc</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>z_s3 <span class="ot">=</span> <span class="fu">read_zarr_array</span>(zarr_s3_b01)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>zarr_s3_x <span class="ot">=</span> <span class="fu">paste0</span>(zarr_s3, <span class="st">"/conditions/mask/detector_footprint/r60m/x"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_zarr_array</span>()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>zarr_s3_y <span class="ot">=</span> <span class="fu">paste0</span>(zarr_s3, <span class="st">"/conditions/mask/detector_footprint/r60m/y"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_zarr_array</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Construct a stars object</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read CRS from attributes</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>zarr_crs <span class="ot">=</span> attr_s3<span class="sc">$</span>stac_discovery<span class="sc">$</span>properties<span class="sc">$</span><span class="st">`</span><span class="at">proj:epsg</span><span class="st">`</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># band name</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>var <span class="ot">=</span> <span class="st">"B01"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># read </span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>zz <span class="ot">=</span> <span class="fu">st_as_stars</span>(z_s3) <span class="sc">|&gt;</span> </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(zarr_crs) <span class="sc">|&gt;</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_dimensions</span>(<span class="dv">1</span>, <span class="at">names =</span> <span class="st">"X"</span>, <span class="at">values =</span> zarr_s3_x) <span class="sc">|&gt;</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_dimensions</span>(<span class="dv">2</span>, <span class="at">names =</span> <span class="st">"Y"</span>, <span class="at">values =</span> zarr_s3_y) <span class="sc">|&gt;</span> </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(var)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>zz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s), summary of first 1e+05 cells:
     Min. 1st Qu. Median   Mean 3rd Qu.  Max.
B01  2240    2836   4362 5655.6    7631 16921
dimension(s):
  from   to  offset delta point x/y
X    1 1830  300030    60 FALSE [x]
Y    1 1830 5000010   -60 FALSE [y]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zz, <span class="at">axes =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="jh_Rarr+stars_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>all in one function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>st_read_zarr_band <span class="ot">=</span> <span class="cf">function</span>(path, var, res, ...){</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stopifnot valid zarr url...</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  attr_s3 <span class="ot">=</span> jsonlite<span class="sc">::</span><span class="fu">read_json</span>(<span class="fu">file.path</span>(path, <span class="st">".zattrs"</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  zarr_crs <span class="ot">=</span> attr_s3<span class="sc">$</span>stac_discovery<span class="sc">$</span>properties<span class="sc">$</span><span class="st">`</span><span class="at">proj:epsg</span><span class="st">`</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># attr_s3$stac_discovery$properties$`eopf:resolutions`</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  res_char <span class="ot">=</span> <span class="cf">switch</span>(<span class="fu">as.character</span>(res),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"10"</span> <span class="ot">=</span> <span class="st">"r10m"</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"20"</span> <span class="ot">=</span> <span class="st">"r20m"</span>, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"60"</span> <span class="ot">=</span> <span class="st">"r60m"</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Resolution must be one of 10, 20, or 60."</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ...: make use of index arguments of read_zarr_array??</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  z_s3 <span class="ot">=</span> <span class="fu">file.path</span>(path, <span class="st">"measurements/reflectance"</span>, res_char, var) <span class="sc">|&gt;</span> </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_zarr_array</span>(...)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  zarr_s3_x <span class="ot">=</span> <span class="fu">file.path</span>(path, <span class="st">"conditions/mask/detector_footprint"</span>, res_char, <span class="st">"x"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_zarr_array</span>(...)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  zarr_s3_y <span class="ot">=</span> <span class="fu">file.path</span>(path, <span class="st">"conditions/mask/detector_footprint"</span>, res_char, <span class="st">"y"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_zarr_array</span>(...)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_stars</span>(z_s3) <span class="sc">|&gt;</span> </span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(zarr_crs)) <span class="sc">|&gt;</span> </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_dimensions</span>(<span class="dv">1</span>, <span class="at">names =</span> <span class="st">"X"</span>, <span class="at">values =</span> zarr_s3_x) <span class="sc">|&gt;</span> </span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_dimensions</span>(<span class="dv">2</span>, <span class="at">names =</span> <span class="st">"Y"</span>, <span class="at">values =</span> zarr_s3_y) <span class="sc">|&gt;</span> </span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(var)</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>test…</p>
</section>
<section id="read-and-combine-multiple-bands" class="level2">
<h2 class="anchored" data-anchor-id="read-and-combine-multiple-bands">Read and combine multiple bands??</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">b01 =</span> <span class="fu">st_read_zarr_band</span>(zarr_s3, <span class="st">"b01"</span>, <span class="dv">60</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s), summary of first 1e+05 cells:
     Min. 1st Qu. Median   Mean 3rd Qu.  Max.
b01  2240    2836   4362 5655.6    7631 16921
dimension(s):
  from   to  offset delta point x/y
X    1 1830  300030    60 FALSE [x]
Y    1 1830 5000010   -60 FALSE [y]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">b09 =</span> <span class="fu">st_read_zarr_band</span>(zarr_s3, <span class="st">"b09"</span>, <span class="dv">60</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>stars object with 2 dimensions and 1 attribute
attribute(s), summary of first 1e+05 cells:
     Min. 1st Qu. Median     Mean 3rd Qu.  Max.
b09   999    1704   2804 4187.666    5802 16773
dimension(s):
  from   to  offset delta point x/y
X    1 1830  300030    60 FALSE [x]
Y    1 1830 5000010   -60 FALSE [y]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(b01, b09) <span class="sc">|&gt;</span> <span class="fu">merge</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>(<span class="at">axes =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>downsample set to 1</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="jh_Rarr+stars_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>